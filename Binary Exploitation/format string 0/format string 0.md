# [format string 0](https://play.picoctf.org/practice/challenge/433)

## Overview

**Points**: 50

**Category**: [Binary Exploitation](../)

## Description

Can you use your knowledge of format strings to make the customers happy?

Download the binary [here](https://artifacts.picoctf.net/c_mimas/78/format-string-0).

Download the source [here](https://artifacts.picoctf.net/c_mimas/78/format-string-0.c).

Connect with the challenge instance here:
`nc mimas.picoctf.net 59468`

## Hints

1. This is an introduction of format string vulnerabilities. Look up "format
specifiers" if you have never seen them before.
2. Just try out the different options

## Solution

Try out the different options in order. If you choose the `Gr%114d_Cheese` option, and then the `Cla%sic_Che%s%steak` option, you will get the flag.

The goal of this challenge is to exploit the format string vulnerability in the program and cause a segfault. The program uses `printf` to print the menu options. The format string vulnerability arises from the fact that the program uses the user input as the format string for `printf`. This allows us to read and write memory locations.

Early in the program, we see this code

```c
int count = printf(choice1);
if (count > 2 * BUFSIZE) {
    serve_bob();
} 
```

`printf` returns the number of characters printed. We want to make the return value of `printf` more than `2 * BUFSIZE` or `64` (since `BUFSIZE` is 32). The format string `%114d` from `Gr%114d_Cheese` prints 114 spaces, followed by the next argument as a decimal number. This means that we can send more than 64 characters.

```c
Welcome to our newly-opened burger place Pico 'n Patty! Can you help the picky customers find their favorite burger?
Here comes the first customer Patrick who wants a giant bite.
Please choose from the following burgers: Breakf@st_Burger, Gr%114d_Cheese, Bac0n_D3luxe
Enter your recommendation: Gr%114d_Cheese
Gr                                                                                                           4202954_Cheese
Good job! Patrick is happy! Now can you serve the second customer?
Sponge Bob wants something outrageous that would break the shop (better be served quick before the shop owner kicks you out!)
Please choose from the following burgers: Pe%to_Portobello, $outhwest_Burger, Cla%sic_Che%s%steak
```

The format string `%s` will print the next string on the stack. Since `Cla%sic_Che%s%steak` has 3 `%s` format specifiers, the program would take the next three arguments from the stack as if they were string pointers, trying to read them as addresses. Because one of these 3 strings are not a valid pointer, it will cause a segfault.

## Flag

`picoCTF{7h3_cu570m3r_15_n3v3r_SEGFAULT_ef312157}`
